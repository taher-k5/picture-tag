{% extends '_layouts/cp' %}
{% import "_includes/forms" as forms %}

{# Set the page title #}
{% set title = 'Picture Tag' %}

{% set tabs = {
    'general': { label: 'General Settings'|t('picture-tag'), url: '#general' },
    'performance': { label: "Performance"|t('picture-tag'), url: '#performance' },
} %}
    {# 'transform': { label: "Transform"|t('picture-tag'), url: '#transform' },  #}

{# Determine the active tab #}
{% set selectedTab = craft.app.request.getQueryParam('tab') | default('general') %}

{# ACTION BUTTON #}
{# NOTE: This button is OUTSIDE the <form> by Craft design #}
{% block actionButton %}
    {% if not readOnly %}
        <input type="submit" class="btn submit" value="{{ 'Save'|t('app') }}" form="settings-form">
    {% endif %}
{% endblock %}

{# CONTENT #}
{% block content %}
    {# IMPORTANT:
       - data-saveshortcut enables Ctrl+S AND Save button
       - actionInput() MUST be used (do NOT duplicate action manually)
    #}
    <form id="settings-form" method="post" accept-charset="UTF-8" data-saveshortcut>
        {{ csrfInput() }}
        {{ actionInput('plugins/save-plugin-settings') }}
        {{ hiddenInput('pluginHandle', 'picture-tag') }}

        {# TABS #}
        <div class="tabs-wrapper" data-tabs>
            <div class="tab-content-wrapper">

            {# General Tab #}
            <div id="general" class="tab-content {% if selectedTab != 'general' %}hidden{% endif %}" data-tab-content="general">

                {{ forms.lightswitchField({
                    label: 'Enable WebP'|t('picture-tag'),
                    name: 'settings[enableWebP]',
                    on: settings.enableWebP
                }) }}

                {{ forms.textField({
                    label: 'WebP Quality'|t,
                    name: 'settings[webpQuality]',
                    value: settings.webpQuality ?? '',
                    placeholder: settings.PLACEHOLDER_WEBP_QUALITY,
                    size: 5
                }) }}

                {{ forms.lightswitchField({
                    label: 'Enable AVIF'|t('picture-tag'),
                    name: 'settings[enableAvif]',
                    on: settings.enableAvif
                }) }}

                {{ forms.textField({
                    label: 'AVIF Quality'|t,
                    name: 'settings[avifQuality]',
                    value: settings.avifQuality ?? '',
                    placeholder: settings.PLACEHOLDER_AVIF_QUALITY,
                    size: 5
                }) }}

                {{ forms.lightswitchField({
                    label: 'Inline SVG'|t('picture-tag'),
                    name: 'settings[inlineSvg]',
                    on: settings.inlineSvg
                }) }}

                {{ forms.lightswitchField({
                    label: 'Enable SVG Optimization'|t('picture-tag'),
                    name: 'settings[enableSvgOptimization]',
                    on: settings.enableSvgOptimization
                }) }}

                {{ forms.lightswitchField({
                    label: 'Enable Debug'|t('picture-tag'),
                    name: 'settings[enableDebug]',
                    on: settings.enableDebug
                }) }}
            </div>
            {# ---------- Default transform ---------- #}
            {# <div id="transform" class="tab-content {% if selectedTab != 'transform' %}hidden{% endif %}" data-tab-content="transform">

                {{ forms.lightswitchField({
                    label: 'Enable Default Transforms'|t('picture-tag'),
                    name: 'settings[enableDefaultTransforms]',
                    on: settings.enableDefaultTransforms
                }) }}

                {% if settings.enableDefaultTransforms %}
                    {% for key, t in settings.PLACEHOLDER_DEFAULT_TRANSFORMS %}
                        <h3>{{ key|capitalize }}</h3>
                        <div class="flex fields">

                            {{ forms.textField({
                                label: 'Width'|t,
                                name: 'settings[defaultTransforms]['~key~'][width]',
                                value: settings.defaultTransforms[key].width ?? t.width,
                                placeholder: t.width,
                                required: true
                            }) }}

                            {{ forms.textField({
                                label: 'Height'|t,
                                name: 'settings[defaultTransforms]['~key~'][height]',
                                value: settings.defaultTransforms[key].height ?? t.height,
                                placeholder: t.height,
                                required: true
                            }) }}

                            {{ forms.textField({
                                label: 'Quality'|t,
                                name: 'settings[defaultTransforms]['~key~'][quality]',
                                value: settings.defaultTransforms[key].quality ?? t.quality,
                                placeholder: t.quality,
                                required: true
                            }) }}

                        </div>
                    {% endfor %}
                {% endif %}
            </div> #}

            {# ---------- PERFORMANCE ---------- #}
            <div id="performance" class="tab-content {% if selectedTab != 'performance' %}hidden{% endif %}" data-tab-content="performance">

                {{ forms.lightswitchField({
                    label: 'Enable Lazy Loading'|t('picture-tag'),
                    name: 'settings[enableLazyLoading]',
                    on: settings.enableLazyLoading
                }) }}

                {{ forms.textareaField({
                    label: 'Lazy Placeholder'|t('picture-tag'),
                    name: 'settings[lazyPlaceholder]',
                    value: settings.lazyPlaceholder ?? '',
                    placeholder: settings.PLACEHOLDER_LAZY_PLACEHOLDER,
                    rows: 3
                }) }}

                {{ forms.lightswitchField({
                    label: 'Enable Cache'|t('picture-tag'),
                    name: 'settings[enableCache]',
                    on: settings.enableCache
                }) }}

                {{ forms.textField({
                    label: 'Cache Duration (seconds)'|t,
                    name: 'settings[cacheDuration]',
                    value: settings.cacheDuration ?? '',
                    placeholder: settings.PLACEHOLDER_CACHE_DURATION,
                    size: 8
                }) }}
            </div>
        </div>
    </div>
</form>
{% endblock %}