{% import "_includes/forms" as forms %}

{% set breakpoints = settings.defaultBreakpoints %}
{% set transforms = settings.defaultTransforms %}

<div class="tabs">
    <ul class="tab-list">
        <li><a href="#general" class="tab-link active">General Settings</a></li>
        <li><a href="#formats">Image Formats</a></li>
        <li><a href="#performance">Performance & Loading</a></li>
        <li><a href="#accessibility">Accessibility & Styling</a></li>
        <li><a href="#advanced">Advanced Settings</a></li>
    </ul>

    <div class="tab-content">
        <div id="general" class="tab-pane active">
            <h2>{{ 'Default Breakpoints' | t('picture-tag') }}</h2>
            {% for key in ['mobile', 'tablet', 'desktop', 'large'] %}
                {{ forms.textField({
                    label: key | capitalize,
                    name: 'defaultBreakpoints[' ~ key ~ ']',
                    value: breakpoints[key] ?? '',
                    errors: settings.getErrors('defaultBreakpoints')
                }) }}
            {% endfor %}

            <h2>{{ 'Default Transforms' | t('picture-tag') }}</h2>
            {% for key in ['mobile', 'tablet', 'desktop', 'large'] %}
                <h3>{{ key | capitalize }}</h3>
                {{ forms.textField({
                    label: 'Width' | t('picture-tag'),
                    name: 'defaultTransforms[' ~ key ~ '][width]',
                    value: transforms[key].width ?? '',
                    errors: settings.getErrors('defaultTransforms')
                }) }}
                {{ forms.textField({
                    label: 'Height' | t('picture-tag'),
                    name: 'defaultTransforms[' ~ key ~ '][height]',
                    value: transforms[key].height ?? '',
                    errors: settings.getErrors('defaultTransforms')
                }) }}
                {{ forms.textField({
                    label: 'Quality' | t('picture-tag'),
                    name: 'defaultTransforms[' ~ key ~ '][quality]',
                    value: transforms[key].quality ?? '',
                    errors: settings.getErrors('defaultTransforms')
                }) }}
            {% endfor %}
        </div>

        <div id="formats" class="tab-pane">
            <h2>{{ 'Format Settings' | t('picture-tag') }}</h2>
            {{ forms.checkboxField({
                label: 'Enable WebP' | t('picture-tag'),
                name: 'enableWebP',
                checked: settings.enableWebP
            }) }}
            {{ forms.textField({
                label: 'WebP Quality' | t('picture-tag'),
                name: 'webpQuality',
                value: settings.webpQuality,
                errors: settings.getErrors('webpQuality')
            }) }}
            {{ forms.checkboxField({
                label: 'Enable AVIF' | t('picture-tag'),
                name: 'enableAvif',
                checked: settings.enableAvif
            }) }}
            {{ forms.textField({
                label: 'AVIF Quality' | t('picture-tag'),
                name: 'avifQuality',
                value: settings.avifQuality,
                errors: settings.getErrors('avifQuality')
            }) }}

            <h2>{{ 'SVG Handling' | t('picture-tag') }}</h2>
            {{ forms.checkboxField({
                label: 'Enable SVG Optimization' | t('picture-tag'),
                name: 'enableSvgOptimization',
                checked: settings.enableSvgOptimization
            }) }}
            {{ forms.checkboxField({
                label: 'Inline SVG' | t('picture-tag'),
                name: 'inlineSvg',
                checked: settings.inlineSvg
            }) }}
            {{ forms.textField({
                label: 'SVG Max Size (bytes)' | t('picture-tag'),
                name: 'svgMaxSize',
                value: settings.svgMaxSize,
                errors: settings.getErrors('svgMaxSize')
            }) }}
        </div>

        <div id="performance" class="tab-pane">
            <h2>{{ 'Lazy Loading' | t('picture-tag') }}</h2>
            {{ forms.checkboxField({
                label: 'Enable Lazy Loading' | t('picture-tag'),
                name: 'enableLazyLoading',
                checked: settings.enableLazyLoading
            }) }}
            {{ forms.textField({
                label: 'Lazy Loading Class' | t('picture-tag'),
                name: 'lazyLoadingClass',
                value: settings.lazyLoadingClass
            }) }}
            {{ forms.textareaField({
                label: 'Lazy Placeholder' | t('picture-tag'),
                name: 'lazyPlaceholder',
                value: settings.lazyPlaceholder
            }) }}

            <h2>{{ 'Performance' | t('picture-tag') }}</h2>
            {{ forms.checkboxField({
                label: 'Enable Preload' | t('picture-tag'),
                name: 'enablePreload',
                checked: settings.enablePreload
            }) }}
            {{ forms.checkboxField({
                label: 'Enable Sizes' | t('picture-tag'),
                name: 'enableSizes',
                checked: settings.enableSizes
            }) }}
            {{ forms.checkboxField({
                label: 'Enable Srcset' | t('picture-tag'),
                name: 'enableSrcset',
                checked: settings.enableSrcset
            }) }}
            {{ forms.checkboxField({
                label: 'Enable Fetch Priority' | t('picture-tag'),
                name: 'enableFetchPriority',
                checked: settings.enableFetchPriority
            }) }}
        </div>

        <div id="accessibility" class="tab-pane">
            <h2>{{ 'Accessibility' | t('picture-tag') }}</h2>
            {{ forms.checkboxField({
                label: 'Require Alt Text' | t('picture-tag'),
                name: 'requireAltText',
                checked: settings.requireAltText
            }) }}
            {{ forms.textField({
                label: 'Default Alt Text' | t('picture-tag'),
                name: 'defaultAltText',
                value: settings.defaultAltText
            }) }}

            <h2>{{ 'Styling' | t('picture-tag') }}</h2>
            {{ forms.checkboxField({
                label: 'Include Default Styles' | t('picture-tag'),
                name: 'includeDefaultStyles',
                checked: settings.includeDefaultStyles
            }) }}
            {{ forms.textField({
                label: 'Default Picture Class' | t('picture-tag'),
                name: 'defaultPictureClass',
                value: settings.defaultPictureClass
            }) }}
            {{ forms.textField({
                label: 'Default Image Class' | t('picture-tag'),
                name: 'defaultImageClass',
                value: settings.defaultImageClass
            }) }}
        </div>

        <div id="advanced" class="tab-pane">
            <h2>{{ 'Advanced' | t('picture-tag') }}</h2>
            {{ forms.checkboxField({
                label: 'Enable Art Direction' | t('picture-tag'),
                name: 'enableArtDirection',
                checked: settings.enableArtDirection
            }) }}
            {{ forms.checkboxField({
                label: 'Enable Cropping' | t('picture-tag'),
                name: 'enableCropping',
                checked: settings.enableCropping
            }) }}
            {{ forms.checkboxField({
                label: 'Enable Focal Point' | t('picture-tag'),
                name: 'enableFocalPoint',
                checked: settings.enableFocalPoint
            }) }}
            {{ forms.checkboxField({
                label: 'Enable Aspect Ratio' | t('picture-tag'),
                name: 'enableAspectRatio',
                checked: settings.enableAspectRatio
            }) }}

            <h2>{{ 'Cache' | t('picture-tag') }}</h2>
            {{ forms.checkboxField({
                label: 'Enable Cache' | t('picture-tag'),
                name: 'enableCache',
                checked: settings.enableCache
            }) }}
            {{ forms.textField({
                label: 'Cache Duration (seconds)' | t('picture-tag'),
                name: 'cacheDuration',
                value: settings.cacheDuration,
                errors: settings.getErrors('cacheDuration')
            }) }}

            <h2>{{ 'Debug' | t('picture-tag') }}</h2>
            {{ forms.checkboxField({
                label: 'Enable Debug' | t('picture-tag'),
                name: 'enableDebug',
                checked: settings.enableDebug
            }) }}
            {{ forms.checkboxField({
                label: 'Show Transform Info' | t('picture-tag'),
                name: 'showTransformInfo',
                checked: settings.showTransformInfo
            }) }}
        </div>
    </div>
</div>

<style>
    .tabs { margin: 20px 0; }
    .tab-list { list-style: none; padding: 0; margin: 0; border-bottom: 1px solid #ccc; display: flex; }
    .tab-list li { margin: 0; }
    .tab-list a { display: block; padding: 10px 20px; text-decoration: none; color: #333; border-bottom: 2px solid transparent; }
    .tab-list a.active { border-bottom: 2px solid #0073aa; color: #0073aa; }
    .tab-content { padding: 20px; }
    .tab-pane { display: none; }
    .tab-pane.active { display: block; }
</style>

{% do craft.app.view.registerJs("
    document.querySelectorAll('.tab-link').forEach(link => {
        link.addEventListener('click', e => {
            e.preventDefault();
            document.querySelectorAll('.tab-link').forEach(l => l.classList.remove('active'));
            document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
            link.classList.add('active');
            document.querySelector(link.getAttribute('href')).classList.add('active');
        });
    });
") %}